# GNX Stage Profiling 数据分析报告

## 1. 数据概览

- **数据来源**: `lookup_table.json`
- **总条目数**: 342
- **设备**: CPU, GPU, NPU
- **Stages**: 1-7
- **Node 规模**: ['1k', '5k', '10k', '20k', '50k', '100k']
- **Edge 规模**: ['1k', '5k', '10k', '50k', '100k', '200k', '500k', '1M']

### Stage 定义

| Stage | 名称 | 操作 | 复杂度 |
|-------|------|------|--------|
| 1 | GATHER | 收集邻居特征 | O(E) |
| 2 | MESSAGE | 消息函数 (identity) | O(E) |
| 3 | REDUCE_SUM | 聚合求和 | O(E) |
| 4 | REDUCE_COUNT | 计算邻居数 | O(E) |
| 5 | NORMALIZE | 计算均值 | O(N) |
| 6 | TRANSFORM | 线性变换 | O(N×F²) |
| 7 | ACTIVATE | ReLU 激活 | O(N×F) |

## 2. Stage 延迟分析

### 2.1 平均 Total Time (ms)

| Stage | CPU | GPU | NPU | GPU加速 | NPU加速 |
|-------|-----|-----|-----|---------|---------|
| 1 | 130.09 | 140.12 | 125.45 | 0.93x | 1.04x |
| 2 | 99.36 | 160.02 | 0.00 | 0.62x | 71930.63x |
| 3 | 324.22 | 105.06 | (跳过) | 3.09x | - |
| 4 | 2.83 | 1.05 | (跳过) | 2.69x | - |
| 5 | 19.32 | 37.12 | 3.63 | 0.52x | 5.32x |
| 6 | 108.71 | 44.15 | 64.07 | 2.46x | 1.70x |
| 7 | 21.30 | 30.98 | 4.12 | 0.69x | 5.17x |

> 加速比 > 1 表示比 CPU 更快

### 2.2 大规模数据性能 (50k-100k nodes)

| Stage | Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快设备 |
|-------|-------|-------|----------|----------|----------|----------|
| 1 | 50k | 100k | 69.81 | 99.47 | 17.01 | **NPU** |
| 1 | 50k | 200k | 137.27 | 161.07 | 24.63 | **NPU** |
| 1 | 50k | 500k | 374.66 | 402.17 | 59.39 | **NPU** |
| 3 | 50k | 100k | 316.10 | 88.08 | - | **GPU** |
| 3 | 50k | 200k | 412.26 | 134.43 | - | **GPU** |
| 3 | 50k | 500k | 908.55 | 270.57 | - | **GPU** |
| 6 | 50k | 100k | 235.41 | 73.72 | 102.73 | **GPU** |
| 6 | 50k | 200k | 178.38 | 72.21 | 99.63 | **GPU** |
| 6 | 50k | 500k | 90.88 | 72.68 | 98.43 | **GPU** |
| 1 | 100k | 200k | 173.36 | 189.90 | 26.12 | **NPU** |
| 1 | 100k | 500k | 376.46 | 418.99 | 61.05 | **NPU** |
| 1 | 100k | 1M | 724.37 | 770.82 | 155.06 | **NPU** |
| 3 | 100k | 200k | 585.42 | 175.24 | - | **GPU** |
| 3 | 100k | 500k | 997.04 | 309.98 | - | **GPU** |
| 3 | 100k | 1M | 1649.41 | 539.01 | - | **GPU** |
| 6 | 100k | 200k | 337.61 | 137.18 | 185.52 | **GPU** |
| 6 | 100k | 500k | 503.50 | 139.26 | 193.92 | **GPU** |
| 6 | 100k | 1M | 320.93 | 139.45 | 185.51 | **GPU** |

## 3. 设备性能对比

### CPU

| Stage | Avg (ms) | Min (ms) | Max (ms) | Compute (ms) | Transfer (ms) |
|-------|----------|----------|----------|--------------|---------------|
| 1 | 130.09 | 2.68 | 724.37 | 3.71 | 132.46 |
| 2 | 99.36 | 0.53 | 589.92 | 0.34 | 100.77 |
| 3 | 324.22 | 1.86 | 1649.41 | 25.62 | 315.01 |
| 4 | 2.83 | 0.18 | 16.53 | 0.07 | 2.90 |
| 5 | 19.32 | 0.62 | 63.17 | 0.06 | 19.53 |
| 6 | 108.71 | 2.77 | 503.50 | 8.54 | 120.94 |
| 7 | 21.30 | 0.59 | 76.84 | 0.21 | 22.67 |

### GPU

| Stage | Avg (ms) | Min (ms) | Max (ms) | Compute (ms) | Transfer (ms) |
|-------|----------|----------|----------|--------------|---------------|
| 1 | 140.12 | 1.50 | 770.82 | 1.41 | 142.58 |
| 2 | 160.02 | 1.21 | 902.10 | 4.19 | 156.26 |
| 3 | 105.06 | 1.91 | 539.01 | 5.31 | 100.03 |
| 4 | 1.05 | 0.61 | 3.01 | 0.64 | 0.41 |
| 5 | 37.12 | 1.51 | 127.26 | 0.28 | 38.30 |
| 6 | 44.15 | 1.99 | 139.45 | 1.28 | 42.94 |
| 7 | 30.98 | 1.21 | 103.99 | 0.30 | 31.58 |

### NPU

| Stage | Avg (ms) | Min (ms) | Max (ms) | Compute (ms) | Transfer (ms) |
|-------|----------|----------|----------|--------------|---------------|
| 1 | 125.45 | 2.03 | 637.71 | 125.45 | 0.00 |
| 2 | 0.00 | 0.00 | 0.00 | 0.00 | 0.00 |
| 3 | - | - | - | - | - |
| 4 | - | - | - | - | - |
| 5 | 3.63 | 0.07 | 11.61 | 0.22 | 3.49 |
| 6 | 64.07 | 4.12 | 193.92 | 7.71 | 56.36 |
| 7 | 4.12 | 0.03 | 11.74 | 0.70 | 3.49 |

## 4. 带宽估计

| Stage | CPU (MB/s) | GPU (MB/s) | NPU (MB/s) |
|-------|------------|------------|------------|
| 1 | 2938.9 | 2730.2 | inf |
| 2 | 6500.5 | 4192.2 | inf |
| 3 | 1235.8 | 3891.7 | - |
| 4 | 944.0 | 6678.6 | - |
| 5 | 6062.0 | 3090.6 | 33901.2 |
| 6 | 1466.7 | 4130.9 | 3147.4 |
| 7 | 5216.6 | 3744.1 | 33873.7 |

## 5. 关键发现

### 5.1 各 Stage 推荐设备 (基于 50k-100k 规模)

- **Stage 1**: NPU (5.4x vs CPU)
- **Stage 2**: NPU (188126.2x vs CPU)
- **Stage 3**: GPU (3.2x vs CPU)
- **Stage 4**: GPU (4.3x vs CPU)
- **Stage 5**: NPU (5.4x vs CPU)
- **Stage 6**: GPU (2.6x vs CPU)
- **Stage 7**: NPU (5.8x vs CPU)

### 5.2 Stage 2 (MESSAGE) 分析

- 平均 compute_time: 1.510 ms
- **结论**: Stage 2 是 identity 函数，compute ≈ 0，total_time 主要是 transfer 开销
- **在融合执行时可忽略**

### 5.3 NPU 限制

- **Stage 3/4 不支持**: scatter_add 操作无法在 NPU 执行
- **小规模效率低**: NPU 启动开销大，适合大规模数据
- **Stage 5-7 适合 NPU**: 密集向量操作，NPU 有优势

## 6. 推荐 PEP 配置

基于 profiling 数据，推荐以下执行策略：

### 方案 A: CPU + GPU (最稳定)
```
Block 0: [CPU] Stage 1-4   # scatter 操作
Block 1: [GPU] Stage 5-7   # 密集计算
```

### 方案 B: CPU + GPU + NPU (最大并行)
```
Block 0: [CPU] Stage 1-4
Block 1: [GPU+NPU] Stage 5-7  # GPU/NPU 并行处理不同 subgraph
```

## 7. 数据验证

| 检查项 | 预期 | 实际 | 状态 |
|--------|------|------|------|
| 总条目数 | 342 | 342 | ✓ |
| CPU 条目 | 126 | 126 | ✓ |
| GPU 条目 | 126 | 126 | ✓ |
| NPU 条目 | 90 | 90 | ✓ |
| NPU Stage 3/4 | 跳过 | 0 条 | ✓ |

---

*生成时间: 基于 1k-100k nodes 的完整 profiling 数据*
## 8. Scalability 分析

### 8.1 各规模下的延迟对比

#### Stage 1: GATHER

| Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快 | GPU/CPU | NPU/CPU |
|-------|-------|----------|----------|----------|------|---------|---------|
| 1k | 1k | 2.68 | 1.50 | 2.03 | **GPU** | 0.56 | 0.75 |
| 1k | 5k | 4.85 | 5.09 | 12.74 | **CPU** | 1.05 | 2.63 |
| 1k | 10k | 10.86 | 8.59 | 14.00 | **GPU** | 0.79 | 1.29 |
| 5k | 5k | 4.23 | 5.53 | 9.41 | **CPU** | 1.31 | 2.22 |
| 5k | 10k | 10.92 | 8.79 | 17.35 | **GPU** | 0.80 | 1.59 |
| 5k | 50k | 45.22 | 38.40 | 148.18 | **GPU** | 0.85 | 3.28 |
| 10k | 10k | 10.73 | 10.87 | 24.36 | **CPU** | 1.01 | 2.27 |
| 10k | 50k | 42.35 | 39.97 | 189.19 | **GPU** | 0.94 | 4.47 |
| 10k | 100k | 83.05 | 83.84 | 637.71 | **CPU** | 1.01 | 7.68 |
| 20k | 50k | 43.08 | 42.47 | 215.47 | **GPU** | 0.99 | 5.00 |
| 20k | 100k | 68.27 | 86.31 | 623.28 | **CPU** | 1.26 | 9.13 |
| 20k | 200k | 159.52 | 148.44 | 21.08 | **NPU** | 0.93 | 0.13 |
| 50k | 100k | 69.81 | 99.47 | 17.01 | **NPU** | 1.42 | 0.24 |
| 50k | 200k | 137.27 | 161.07 | 24.63 | **NPU** | 1.17 | 0.18 |
| 50k | 500k | 374.66 | 402.17 | 59.39 | **NPU** | 1.07 | 0.16 |
| 100k | 200k | 173.36 | 189.90 | 26.12 | **NPU** | 1.10 | 0.15 |
| 100k | 500k | 376.46 | 418.99 | 61.05 | **NPU** | 1.11 | 0.16 |
| 100k | 1M | 724.37 | 770.82 | 155.06 | **NPU** | 1.06 | 0.21 |

#### Stage 2: MESSAGE

| Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快 | GPU/CPU | NPU/CPU |
|-------|-------|----------|----------|----------|------|---------|---------|
| 1k | 1k | 0.53 | 1.21 | 0.00 | **NPU** | 2.28 | 0.00 |
| 1k | 5k | 2.79 | 5.00 | 0.00 | **NPU** | 1.80 | 0.00 |
| 1k | 10k | 6.58 | 9.23 | 0.00 | **NPU** | 1.40 | 0.00 |
| 5k | 5k | 2.70 | 4.96 | 0.00 | **NPU** | 1.84 | 0.00 |
| 5k | 10k | 6.57 | 9.87 | 0.00 | **NPU** | 1.50 | 0.00 |
| 5k | 50k | 30.37 | 47.22 | 0.00 | **NPU** | 1.55 | 0.00 |
| 10k | 10k | 6.37 | 9.12 | 0.00 | **NPU** | 1.43 | 0.00 |
| 10k | 50k | 29.21 | 47.40 | 0.00 | **NPU** | 1.62 | 0.00 |
| 10k | 100k | 55.83 | 100.70 | 0.00 | **NPU** | 1.80 | 0.00 |
| 20k | 50k | 27.32 | 46.90 | 0.00 | **NPU** | 1.72 | 0.00 |
| 20k | 100k | 56.12 | 101.54 | 0.00 | **NPU** | 1.81 | 0.00 |
| 20k | 200k | 113.26 | 188.52 | 0.00 | **NPU** | 1.66 | 0.00 |
| 50k | 100k | 55.69 | 93.07 | 0.00 | **NPU** | 1.67 | 0.00 |
| 50k | 200k | 114.30 | 189.57 | 0.00 | **NPU** | 1.66 | 0.00 |
| 50k | 500k | 289.19 | 465.74 | 0.00 | **NPU** | 1.61 | 0.00 |
| 100k | 200k | 112.36 | 188.07 | 0.00 | **NPU** | 1.67 | 0.00 |
| 100k | 500k | 289.36 | 470.11 | 0.00 | **NPU** | 1.62 | 0.00 |
| 100k | 1M | 589.92 | 902.10 | 0.00 | **NPU** | 1.53 | 0.00 |

#### Stage 3: REDUCE_SUM

| Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快 | GPU/CPU | NPU/CPU |
|-------|-------|----------|----------|----------|------|---------|---------|
| 1k | 1k | 1.86 | 1.91 | - | **CPU** | 1.02 | - |
| 1k | 5k | 6.42 | 3.75 | - | **GPU** | 0.58 | - |
| 1k | 10k | 12.00 | 6.88 | - | **GPU** | 0.57 | - |
| 5k | 5k | 11.42 | 6.69 | - | **GPU** | 0.59 | - |
| 5k | 10k | 17.90 | 9.36 | - | **GPU** | 0.52 | - |
| 5k | 50k | 95.65 | 28.65 | - | **GPU** | 0.30 | - |
| 10k | 10k | 33.20 | 13.38 | - | **GPU** | 0.40 | - |
| 10k | 50k | 124.66 | 33.88 | - | **GPU** | 0.27 | - |
| 10k | 100k | 242.99 | 55.28 | - | **GPU** | 0.23 | - |
| 20k | 50k | 68.97 | 40.98 | - | **GPU** | 0.59 | - |
| 20k | 100k | 95.34 | 62.76 | - | **GPU** | 0.66 | - |
| 20k | 200k | 256.81 | 110.23 | - | **GPU** | 0.43 | - |
| 50k | 100k | 316.10 | 88.08 | - | **GPU** | 0.28 | - |
| 50k | 200k | 412.26 | 134.43 | - | **GPU** | 0.33 | - |
| 50k | 500k | 908.55 | 270.57 | - | **GPU** | 0.30 | - |
| 100k | 200k | 585.42 | 175.24 | - | **GPU** | 0.30 | - |
| 100k | 500k | 997.04 | 309.98 | - | **GPU** | 0.31 | - |
| 100k | 1M | 1649.41 | 539.01 | - | **GPU** | 0.33 | - |

#### Stage 4: REDUCE_COUNT

| Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快 | GPU/CPU | NPU/CPU |
|-------|-------|----------|----------|----------|------|---------|---------|
| 1k | 1k | 0.18 | 0.69 | - | **CPU** | 3.86 | - |
| 1k | 5k | 0.20 | 0.65 | - | **CPU** | 3.24 | - |
| 1k | 10k | 0.27 | 0.64 | - | **CPU** | 2.40 | - |
| 5k | 5k | 0.23 | 0.61 | - | **CPU** | 2.70 | - |
| 5k | 10k | 0.29 | 0.78 | - | **CPU** | 2.71 | - |
| 5k | 50k | 0.60 | 0.86 | - | **CPU** | 1.43 | - |
| 10k | 10k | 0.28 | 0.69 | - | **CPU** | 2.41 | - |
| 10k | 50k | 0.61 | 0.66 | - | **CPU** | 1.08 | - |
| 10k | 100k | 1.36 | 0.90 | - | **GPU** | 0.66 | - |
| 20k | 50k | 0.65 | 0.70 | - | **CPU** | 1.07 | - |
| 20k | 100k | 1.35 | 0.94 | - | **GPU** | 0.70 | - |
| 20k | 200k | 3.18 | 1.16 | - | **GPU** | 0.37 | - |
| 50k | 100k | 1.50 | 0.86 | - | **GPU** | 0.57 | - |
| 50k | 200k | 3.79 | 1.02 | - | **GPU** | 0.27 | - |
| 50k | 500k | 8.13 | 1.75 | - | **GPU** | 0.22 | - |
| 100k | 200k | 3.18 | 1.18 | - | **GPU** | 0.37 | - |
| 100k | 500k | 8.66 | 1.88 | - | **GPU** | 0.22 | - |
| 100k | 1M | 16.53 | 3.01 | - | **GPU** | 0.18 | - |

#### Stage 5: NORMALIZE

| Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快 | GPU/CPU | NPU/CPU |
|-------|-------|----------|----------|----------|------|---------|---------|
| 1k | 1k | 0.66 | 1.51 | 0.19 | **NPU** | 2.29 | 0.29 |
| 1k | 5k | 0.62 | 1.74 | 0.07 | **NPU** | 2.79 | 0.11 |
| 1k | 10k | 0.68 | 1.72 | 0.94 | **CPU** | 2.52 | 1.38 |
| 5k | 5k | 2.69 | 6.06 | 0.30 | **NPU** | 2.25 | 0.11 |
| 5k | 10k | 2.71 | 5.95 | 0.18 | **NPU** | 2.19 | 0.07 |
| 5k | 50k | 2.70 | 5.92 | 0.50 | **NPU** | 2.19 | 0.18 |
| 10k | 10k | 5.87 | 12.35 | 1.07 | **NPU** | 2.10 | 0.18 |
| 10k | 50k | 5.96 | 11.30 | 1.21 | **NPU** | 1.90 | 0.20 |
| 10k | 100k | 5.72 | 11.90 | 1.22 | **NPU** | 2.08 | 0.21 |
| 20k | 50k | 12.36 | 22.53 | 2.57 | **NPU** | 1.82 | 0.21 |
| 20k | 100k | 12.56 | 21.91 | 2.64 | **NPU** | 1.74 | 0.21 |
| 20k | 200k | 12.58 | 22.24 | 2.58 | **NPU** | 1.77 | 0.21 |
| 50k | 100k | 32.13 | 56.61 | 6.01 | **NPU** | 1.76 | 0.19 |
| 50k | 200k | 31.60 | 56.76 | 6.05 | **NPU** | 1.80 | 0.19 |
| 50k | 500k | 30.81 | 55.90 | 6.10 | **NPU** | 1.81 | 0.20 |
| 100k | 200k | 61.87 | 123.07 | 10.62 | **NPU** | 1.99 | 0.17 |
| 100k | 500k | 63.17 | 123.42 | 11.52 | **NPU** | 1.95 | 0.18 |
| 100k | 1M | 62.98 | 127.26 | 11.61 | **NPU** | 2.02 | 0.18 |

#### Stage 6: TRANSFORM

| Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快 | GPU/CPU | NPU/CPU |
|-------|-------|----------|----------|----------|------|---------|---------|
| 1k | 1k | 3.67 | 2.10 | 4.12 | **GPU** | 0.57 | 1.12 |
| 1k | 5k | 2.93 | 1.99 | 4.33 | **GPU** | 0.68 | 1.48 |
| 1k | 10k | 2.77 | 2.06 | 4.14 | **GPU** | 0.74 | 1.49 |
| 5k | 5k | 12.91 | 7.74 | 18.50 | **GPU** | 0.60 | 1.43 |
| 5k | 10k | 12.75 | 7.84 | 18.36 | **GPU** | 0.61 | 1.44 |
| 5k | 50k | 12.48 | 7.73 | 18.35 | **GPU** | 0.62 | 1.47 |
| 10k | 10k | 28.64 | 15.09 | 28.87 | **GPU** | 0.53 | 1.01 |
| 10k | 50k | 28.65 | 15.24 | 29.58 | **GPU** | 0.53 | 1.03 |
| 10k | 100k | 28.46 | 14.93 | 28.55 | **GPU** | 0.52 | 1.00 |
| 20k | 50k | 42.96 | 28.54 | 44.26 | **GPU** | 0.66 | 1.03 |
| 20k | 100k | 42.76 | 28.13 | 44.83 | **GPU** | 0.66 | 1.05 |
| 20k | 200k | 71.17 | 28.82 | 43.58 | **GPU** | 0.40 | 0.61 |
| 50k | 100k | 235.41 | 73.72 | 102.73 | **GPU** | 0.31 | 0.44 |
| 50k | 200k | 178.38 | 72.21 | 99.63 | **GPU** | 0.40 | 0.56 |
| 50k | 500k | 90.88 | 72.68 | 98.43 | **GPU** | 0.80 | 1.08 |
| 100k | 200k | 337.61 | 137.18 | 185.52 | **GPU** | 0.41 | 0.55 |
| 100k | 500k | 503.50 | 139.26 | 193.92 | **GPU** | 0.28 | 0.39 |
| 100k | 1M | 320.93 | 139.45 | 185.51 | **GPU** | 0.43 | 0.58 |

#### Stage 7: ACTIVATE

| Nodes | Edges | CPU (ms) | GPU (ms) | NPU (ms) | 最快 | GPU/CPU | NPU/CPU |
|-------|-------|----------|----------|----------|------|---------|---------|
| 1k | 1k | 0.65 | 1.21 | 0.03 | **NPU** | 1.87 | 0.04 |
| 1k | 5k | 0.78 | 2.78 | 0.05 | **NPU** | 3.54 | 0.06 |
| 1k | 10k | 0.59 | 1.64 | 0.03 | **NPU** | 2.78 | 0.05 |
| 5k | 5k | 2.66 | 5.61 | 0.13 | **NPU** | 2.11 | 0.05 |
| 5k | 10k | 2.71 | 5.06 | 0.16 | **NPU** | 1.86 | 0.06 |
| 5k | 50k | 2.76 | 4.98 | 1.75 | **NPU** | 1.81 | 0.64 |
| 10k | 10k | 5.94 | 9.70 | 1.52 | **NPU** | 1.63 | 0.26 |
| 10k | 50k | 5.94 | 9.38 | 2.36 | **NPU** | 1.58 | 0.40 |
| 10k | 100k | 6.15 | 9.49 | 2.20 | **NPU** | 1.54 | 0.36 |
| 20k | 50k | 12.80 | 18.49 | 3.79 | **NPU** | 1.44 | 0.30 |
| 20k | 100k | 12.52 | 18.61 | 4.15 | **NPU** | 1.49 | 0.33 |
| 20k | 200k | 12.61 | 18.70 | 3.53 | **NPU** | 1.48 | 0.28 |
| 50k | 100k | 31.54 | 47.80 | 6.27 | **NPU** | 1.52 | 0.20 |
| 50k | 200k | 31.26 | 48.44 | 6.63 | **NPU** | 1.55 | 0.21 |
| 50k | 500k | 35.18 | 47.84 | 7.05 | **NPU** | 1.36 | 0.20 |
| 100k | 200k | 71.16 | 102.02 | 11.06 | **NPU** | 1.43 | 0.16 |
| 100k | 500k | 71.32 | 103.99 | 11.74 | **NPU** | 1.46 | 0.16 |
| 100k | 1M | 76.84 | 101.85 | 11.74 | **NPU** | 1.33 | 0.15 |

### 8.2 Scaling 效率 (10x 数据量的延迟增长)

对比 10k nodes → 100k nodes 的延迟增长倍数（理想线性 = 10x）：

| Stage | CPU 增长 | GPU 增长 | NPU 增长 | 最佳 Scaling |
|-------|----------|----------|----------|--------------|
| 1 | 9.4x | 10.2x | 0.3x | **NPU** |
| 2 | 10.8x | 9.9x | 0.6x | **NPU** |
| 3 | 8.1x | 10.0x | - | **CPU** |
| 4 | 12.6x | 2.7x | - | **GPU** |
| 5 | 10.7x | 10.5x | 9.6x | **NPU** |
| 6 | 13.6x | 9.2x | 6.5x | **NPU** |
| 7 | 12.2x | 10.8x | 5.7x | **NPU** |

> 增长倍数越小表示 scaling 越好（理想情况下线性 O(n) 操作应该是 10x）

### 8.3 按 Nodes 规模的平均延迟 (ms)

| Nodes | Stage 1 CPU | Stage 1 GPU | Stage 1 NPU | Stage 3 CPU | Stage 3 GPU | Stage 6 CPU | Stage 6 GPU |
|-------|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 1k | 6.1 | 5.1 | 9.6 | 6.8 | 4.2 | 3.1 | 2.0 |
| 5k | 20.1 | 17.6 | 58.3 | 41.7 | 14.9 | 12.7 | 7.8 |
| 10k | 45.4 | 44.9 | 283.8 | 133.6 | 34.2 | 28.6 | 15.1 |
| 20k | 90.3 | 92.4 | 286.6 | 140.4 | 71.3 | 52.3 | 28.5 |
| 50k | 193.9 | 220.9 | 33.7 | 545.6 | 164.4 | 168.2 | 72.9 |
| 100k | 424.7 | 459.9 | 80.7 | 1077.3 | 341.4 | 387.3 | 138.6 |

### 8.4 GPU 加速比随规模变化

| Nodes | S1 | S2 | S3 | S4 | S5 | S6 | S7 |
|-------|-----|-----|-----|-----|-----|-----|-----|
| 1k | 1.21 | 0.64 | 1.62 | 0.33 | 0.40 | 1.52 | 0.36 |
| 5k | 1.15 | 0.64 | 2.80 | 0.50 | 0.45 | 1.64 | 0.52 |
| 10k | 1.01 | 0.58 | 3.91 | 1.00 | 0.49 | 1.89 | 0.63 |
| 20k | 0.98 | 0.58 | 1.97 | 1.85 | 0.56 | 1.84 | 0.68 |
| 50k | 0.88 | 0.61 | 3.32 | 3.69 | 0.56 | 2.31 | 0.68 |
| 100k | 0.92 | 0.64 | 3.16 | 4.68 | 0.50 | 2.79 | 0.71 |

> 值 > 1 表示 GPU 更快，值越大 GPU 优势越明显

### 8.5 NPU 加速比随规模变化

| Nodes | S1 | S2 | S5 | S6 | S7 |
|-------|-----|-----|-----|-----|-----|
| 1k | 0.64 | 3171.19 | 1.64 | 0.74 | 19.84 |
| 5k | 0.35 | 7046.24 | 8.28 | 0.69 | 3.98 |
| 10k | 0.16 | 18580.69 | 5.01 | 0.99 | 2.97 |
| 20k | 0.32 | 56425.75 | 4.81 | 1.18 | 3.31 |
| 50k | 5.76 | 99997.45 | 5.20 | 1.68 | 4.91 |
| 100k | 5.26 | 317833.66 | 5.57 | 2.06 | 6.35 |

> 值 > 1 表示 NPU 更快

### 8.6 Scalability 结论

1. **GPU Scaling**:
   - Stage 3 (REDUCE_SUM): GPU 加速比随规模增大而增大 (1k: ~1x → 100k: ~3x)
   - Stage 6 (TRANSFORM): GPU 始终有优势，大规模时更明显

2. **NPU Scaling**:
   - Stage 1 (GATHER): NPU 在大规模时优势显著 (100k: 5-6x)
   - Stage 5/7: NPU 在所有规模都有明显优势
   - **小规模 (1k-5k) NPU 可能比 CPU 慢**（启动开销）

3. **推荐策略**:
   - 小规模 subgraph (< 10k): 使用 CPU + GPU
   - 大规模 subgraph (> 50k): 可以引入 NPU 提升 Stage 1, 5, 7

## 9. 各数据规模详细延迟表

以下为每个 (nodes, edges) 组合的各 Stage 延迟 (ms)：

### 1k nodes, 1k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 2.68 | 1.50 | 2.03 | **GPU** |
| 2 | 0.53 | 1.21 | 0.00 | **NPU** |
| 3 | 1.86 | 1.91 | - | **CPU** |
| 4 | 0.18 | 0.69 | - | **CPU** |
| 5 | 0.66 | 1.51 | 0.19 | **NPU** |
| 6 | 3.67 | 2.10 | 4.12 | **GPU** |
| 7 | 0.65 | 1.21 | 0.03 | **NPU** |
| **Total** | **10.23** | **10.12** | **6.37** | |

### 1k nodes, 5k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 4.85 | 5.09 | 12.74 | **CPU** |
| 2 | 2.79 | 5.00 | 0.00 | **NPU** |
| 3 | 6.42 | 3.75 | - | **GPU** |
| 4 | 0.20 | 0.65 | - | **CPU** |
| 5 | 0.62 | 1.74 | 0.07 | **NPU** |
| 6 | 2.93 | 1.99 | 4.33 | **GPU** |
| 7 | 0.78 | 2.78 | 0.05 | **NPU** |
| **Total** | **18.59** | **21.00** | **17.19** | |

### 1k nodes, 10k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 10.86 | 8.59 | 14.00 | **GPU** |
| 2 | 6.58 | 9.23 | 0.00 | **NPU** |
| 3 | 12.00 | 6.88 | - | **GPU** |
| 4 | 0.27 | 0.64 | - | **CPU** |
| 5 | 0.68 | 1.72 | 0.94 | **CPU** |
| 6 | 2.77 | 2.06 | 4.14 | **GPU** |
| 7 | 0.59 | 1.64 | 0.03 | **NPU** |
| **Total** | **33.75** | **30.76** | **19.11** | |

### 5k nodes, 5k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 4.23 | 5.53 | 9.41 | **CPU** |
| 2 | 2.70 | 4.96 | 0.00 | **NPU** |
| 3 | 11.42 | 6.69 | - | **GPU** |
| 4 | 0.23 | 0.61 | - | **CPU** |
| 5 | 2.69 | 6.06 | 0.30 | **NPU** |
| 6 | 12.91 | 7.74 | 18.50 | **GPU** |
| 7 | 2.66 | 5.61 | 0.13 | **NPU** |
| **Total** | **36.83** | **37.21** | **28.35** | |

### 5k nodes, 10k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 10.92 | 8.79 | 17.35 | **GPU** |
| 2 | 6.57 | 9.87 | 0.00 | **NPU** |
| 3 | 17.90 | 9.36 | - | **GPU** |
| 4 | 0.29 | 0.78 | - | **CPU** |
| 5 | 2.71 | 5.95 | 0.18 | **NPU** |
| 6 | 12.75 | 7.84 | 18.36 | **GPU** |
| 7 | 2.71 | 5.06 | 0.16 | **NPU** |
| **Total** | **53.85** | **47.64** | **36.05** | |

### 5k nodes, 50k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 45.22 | 38.40 | 148.18 | **GPU** |
| 2 | 30.37 | 47.22 | 0.00 | **NPU** |
| 3 | 95.65 | 28.65 | - | **GPU** |
| 4 | 0.60 | 0.86 | - | **CPU** |
| 5 | 2.70 | 5.92 | 0.50 | **NPU** |
| 6 | 12.48 | 7.73 | 18.35 | **GPU** |
| 7 | 2.76 | 4.98 | 1.75 | **NPU** |
| **Total** | **189.78** | **133.75** | **168.79** | |

### 10k nodes, 10k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 10.73 | 10.87 | 24.36 | **CPU** |
| 2 | 6.37 | 9.12 | 0.00 | **NPU** |
| 3 | 33.20 | 13.38 | - | **GPU** |
| 4 | 0.28 | 0.69 | - | **CPU** |
| 5 | 5.87 | 12.35 | 1.07 | **NPU** |
| 6 | 28.64 | 15.09 | 28.87 | **GPU** |
| 7 | 5.94 | 9.70 | 1.52 | **NPU** |
| **Total** | **91.03** | **71.19** | **55.82** | |

### 10k nodes, 50k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 42.35 | 39.97 | 189.19 | **GPU** |
| 2 | 29.21 | 47.40 | 0.00 | **NPU** |
| 3 | 124.66 | 33.88 | - | **GPU** |
| 4 | 0.61 | 0.66 | - | **CPU** |
| 5 | 5.96 | 11.30 | 1.21 | **NPU** |
| 6 | 28.65 | 15.24 | 29.58 | **GPU** |
| 7 | 5.94 | 9.38 | 2.36 | **NPU** |
| **Total** | **237.40** | **157.83** | **222.35** | |

### 10k nodes, 100k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 83.05 | 83.84 | 637.71 | **CPU** |
| 2 | 55.83 | 100.70 | 0.00 | **NPU** |
| 3 | 242.99 | 55.28 | - | **GPU** |
| 4 | 1.36 | 0.90 | - | **GPU** |
| 5 | 5.72 | 11.90 | 1.22 | **NPU** |
| 6 | 28.46 | 14.93 | 28.55 | **GPU** |
| 7 | 6.15 | 9.49 | 2.20 | **NPU** |
| **Total** | **423.56** | **277.05** | **669.68** | |

### 20k nodes, 50k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 43.08 | 42.47 | 215.47 | **GPU** |
| 2 | 27.32 | 46.90 | 0.00 | **NPU** |
| 3 | 68.97 | 40.98 | - | **GPU** |
| 4 | 0.65 | 0.70 | - | **CPU** |
| 5 | 12.36 | 22.53 | 2.57 | **NPU** |
| 6 | 42.96 | 28.54 | 44.26 | **GPU** |
| 7 | 12.80 | 18.49 | 3.79 | **NPU** |
| **Total** | **208.15** | **200.60** | **266.09** | |

### 20k nodes, 100k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 68.27 | 86.31 | 623.28 | **CPU** |
| 2 | 56.12 | 101.54 | 0.00 | **NPU** |
| 3 | 95.34 | 62.76 | - | **GPU** |
| 4 | 1.35 | 0.94 | - | **GPU** |
| 5 | 12.56 | 21.91 | 2.64 | **NPU** |
| 6 | 42.76 | 28.13 | 44.83 | **GPU** |
| 7 | 12.52 | 18.61 | 4.15 | **NPU** |
| **Total** | **288.92** | **320.19** | **674.90** | |

### 20k nodes, 200k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 159.52 | 148.44 | 21.08 | **NPU** |
| 2 | 113.26 | 188.52 | 0.00 | **NPU** |
| 3 | 256.81 | 110.23 | - | **GPU** |
| 4 | 3.18 | 1.16 | - | **GPU** |
| 5 | 12.58 | 22.24 | 2.58 | **NPU** |
| 6 | 71.17 | 28.82 | 43.58 | **GPU** |
| 7 | 12.61 | 18.70 | 3.53 | **NPU** |
| **Total** | **629.13** | **518.10** | **70.77** | |

### 50k nodes, 100k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 69.81 | 99.47 | 17.01 | **NPU** |
| 2 | 55.69 | 93.07 | 0.00 | **NPU** |
| 3 | 316.10 | 88.08 | - | **GPU** |
| 4 | 1.50 | 0.86 | - | **GPU** |
| 5 | 32.13 | 56.61 | 6.01 | **NPU** |
| 6 | 235.41 | 73.72 | 102.73 | **GPU** |
| 7 | 31.54 | 47.80 | 6.27 | **NPU** |
| **Total** | **742.17** | **459.61** | **132.02** | |

### 50k nodes, 200k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 137.27 | 161.07 | 24.63 | **NPU** |
| 2 | 114.30 | 189.57 | 0.00 | **NPU** |
| 3 | 412.26 | 134.43 | - | **GPU** |
| 4 | 3.79 | 1.02 | - | **GPU** |
| 5 | 31.60 | 56.76 | 6.05 | **NPU** |
| 6 | 178.38 | 72.21 | 99.63 | **GPU** |
| 7 | 31.26 | 48.44 | 6.63 | **NPU** |
| **Total** | **908.86** | **663.51** | **136.94** | |

### 50k nodes, 500k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 374.66 | 402.17 | 59.39 | **NPU** |
| 2 | 289.19 | 465.74 | 0.00 | **NPU** |
| 3 | 908.55 | 270.57 | - | **GPU** |
| 4 | 8.13 | 1.75 | - | **GPU** |
| 5 | 30.81 | 55.90 | 6.10 | **NPU** |
| 6 | 90.88 | 72.68 | 98.43 | **GPU** |
| 7 | 35.18 | 47.84 | 7.05 | **NPU** |
| **Total** | **1737.41** | **1316.64** | **170.99** | |

### 100k nodes, 200k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 173.36 | 189.90 | 26.12 | **NPU** |
| 2 | 112.36 | 188.07 | 0.00 | **NPU** |
| 3 | 585.42 | 175.24 | - | **GPU** |
| 4 | 3.18 | 1.18 | - | **GPU** |
| 5 | 61.87 | 123.07 | 10.62 | **NPU** |
| 6 | 337.61 | 137.18 | 185.52 | **GPU** |
| 7 | 71.16 | 102.02 | 11.06 | **NPU** |
| **Total** | **1344.97** | **916.67** | **233.32** | |

### 100k nodes, 500k edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 376.46 | 418.99 | 61.05 | **NPU** |
| 2 | 289.36 | 470.11 | 0.00 | **NPU** |
| 3 | 997.04 | 309.98 | - | **GPU** |
| 4 | 8.66 | 1.88 | - | **GPU** |
| 5 | 63.17 | 123.42 | 11.52 | **NPU** |
| 6 | 503.50 | 139.26 | 193.92 | **GPU** |
| 7 | 71.32 | 103.99 | 11.74 | **NPU** |
| **Total** | **2309.50** | **1567.62** | **278.24** | |

### 100k nodes, 1M edges

| Stage | CPU (ms) | GPU (ms) | NPU (ms) | 最快 |
|-------|----------|----------|----------|------|
| 1 | 724.37 | 770.82 | 155.06 | **NPU** |
| 2 | 589.92 | 902.10 | 0.00 | **NPU** |
| 3 | 1649.41 | 539.01 | - | **GPU** |
| 4 | 16.53 | 3.01 | - | **GPU** |
| 5 | 62.98 | 127.26 | 11.61 | **NPU** |
| 6 | 320.93 | 139.45 | 185.51 | **GPU** |
| 7 | 76.84 | 101.85 | 11.74 | **NPU** |
| **Total** | **3440.99** | **2583.50** | **363.92** | |
